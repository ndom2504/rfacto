<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>RfactO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Emp√™che la requ√™te automatique /favicon.ico (utile en local avec http.server) -->
    <link rel="icon" href="data:," />

    <!-- Styles principaux -->
    <link rel="stylesheet" href="styles.css?v=20260127-1" />

    <!-- Librairies pour export ZIP & Excel (utilis√©es dans app.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- MSAL.js pour authentification Azure AD -->
    <script src="https://alcdn.msauth.net/browser/2.38.1/js/msal-browser.min.js"></script>
    <script src="auth.js?v=20260203-1"></script>
  </head>
  <body>
    <!-- √âcran de connexion (overlay) -->
    <div id="loginOverlay" class="login-overlay">
      <div class="login-container">
        <div class="logo">
          <div class="logo-dot"></div>
          <div class="logo-text">RfactO</div>
        </div>
        <div class="logo-sub">Claims & Milestones</div>
        
        <h1>Bienvenue</h1>
        <p>Connectez-vous avec votre compte Microsoft pour acc√©der √† l'application.</p>
        
        <div id="loginError" class="error-message"></div>
        
        <button id="loginBtn" class="btn-microsoft">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 23 23" fill="currentColor">
            <path d="M11 0H0v11h11V0z" fill="#f25022"/>
            <path d="M23 0H12v11h11V0z" fill="#7fba00"/>
            <path d="M11 12H0v11h11V12z" fill="#00a4ef"/>
            <path d="M23 12H12v11h11V12z" fill="#ffb900"/>
          </svg>
          Se connecter avec Microsoft
        </button>
        
        <div id="loginLoading" class="loading" style="display: none;">
          <span class="spinner"></span>
          Connexion en cours...
        </div>
      </div>
    </div>

    <div class="app-shell" id="appShell" style="display: none;">
      <!-- ===== SIDEBAR ===================================================== -->
      <aside class="sidebar">
        <div class="sidebar-logo">
          <div class="logo-dot"></div>
          <div class="logo-text">
            <div class="logo-title">RfactO</div>
            <div class="logo-sub">Claims &amp; Milestones</div>
          </div>
        </div>

        <nav class="sidebar-nav">
          <button class="tab-btn active" data-tab="registre">
            <span>Registre</span>
            <span class="badge" id="badgeRegistre">0</span>
          </button>
          <button class="tab-btn" data-tab="bilan">
            <span>Bilan</span>
            <span class="badge" id="badgeBilan">0</span>
          </button>
          <button class="tab-btn" data-tab="rapport">
            <span>Rapport</span>
          </button>
          <button class="tab-btn" data-tab="archive">
            <span>Archive</span>
          </button>
          <button class="tab-btn" data-tab="audit">
            <span>Audit</span>
          </button>
          <button class="tab-btn" data-tab="traitement">
            <span>Traitement</span>
            <span class="badge" id="badgeTraitement">0</span>
          </button>
          <button class="tab-btn" data-tab="parametres">
            <span>Param√®tres</span>
          </button>
        </nav>

        <div class="sidebar-footer">
          <button
            id="btnOpenSettings"
            class="icon-btn"
            title="Ouvrir les param√®tres"
          >
            ‚öô
          </button>
        </div>
      </aside>

      <!-- ===== MAIN PANEL ================================================== -->
      <main class="main-panel">
        <!-- TOP BAR -->
        <header class="topbar">
          <div class="topbar-left">
            <h1 class="topbar-title">Dashboard projet</h1>
            <p class="topbar-subtitle">
              Suivi des claims, facturation et dossiers d‚Äôaudit.
            </p>
          </div>
          <div class="topbar-right">
            <div class="user-bubble-container">
              <div class="user-bubble" id="userBubble" title="Utilisateur connect√©">
                <span id="userInitials">A</span>
              </div>
              <div class="user-dropdown" id="userDropdown" style="display: none;">
                <div class="user-dropdown-header">
                  <div class="user-dropdown-name" id="userDropdownName">Utilisateur</div>
                  <div class="user-dropdown-email" id="userDropdownEmail">email@example.com</div>
                </div>
                <div class="user-dropdown-divider"></div>
                <button class="user-dropdown-item" id="btnUserSettings">
                  <span class="user-dropdown-icon">‚öôÔ∏è</span>
                  Param√®tres
                </button>
                <button class="user-dropdown-item" id="btnUserLogout">
                  <span class="user-dropdown-icon">üö™</span>
                  D√©connexion
                </button>
              </div>
            </div>
            <button id="btnFichier" class="icon-btn" title="Fichiers">
              üìÅ
            </button>
            <button id="btnNotifications" class="icon-btn" title="Notifications">
              üîî <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
            </button>
            <div id="notificationDropdown" class="notification-dropdown" style="display: none;">
              <div class="notification-header">Notifications</div>
              <div id="notificationList" class="notification-list"></div>
            </div>
          </div>
        </header>

        <!-- ====== TABS CONTENT ============================================== -->

        <!-- === REGISTRE ==================================================== -->
        <section id="tab-registre" class="tab-panel active">
          <div class="tab-header">
            <div>
              <h2>Registre des claims</h2>
              <p class="muted">
                Vue principale de toutes les claims. Filtrez, √©ditez et ins√©rez
                des lignes.
              </p>
            </div>
            <div class="tab-header-actions">
              <button id="btnAddClaim" class="btn primary">‚ûï Nouvelle claim</button>
            </div>
          </div>

          <!-- Filtres registre -->
          <div class="filters-row">
            <div class="filter-group">
              <label for="filterRegType">Type</label>
              <select id="filterRegType">
                <option value="all">Tous</option>
                <option value="milestone">Milestone</option>
                <option value="dcr">DCR</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="filterRegProjet">Projet</label>
              <select id="filterRegProjet">
                <option value="all">Tous</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="filterRegStatut">Statut</label>
              <select id="filterRegStatut">
                <option value="all">Tous</option>
                <option value="√Ä facturer">√Ä facturer</option>
                <option value="Factur√©">Factur√©</option>
                <option value="Approuv√©">Approuv√©</option>
                <option value="Pay√©">Pay√©</option>
                <option value="Annul√©">Annul√©</option>
              </select>
            </div>

            <div class="filter-group">
              <label>P√©riode</label>
              <div class="filter-inline">
                <label class="radio-pill">
                  <input type="radio" name="regDateMode" value="all" checked />
                  <span>Toutes</span>
                </label>
                <label class="radio-pill">
                  <input type="radio" name="regDateMode" value="period" />
                  <span>Entre</span>
                </label>
              </div>
              <div id="regDateRange" class="filter-daterange" style="display: none;">
                <input id="filterRegDateFrom" type="date" />
                <span>‚Üí</span>
                <input id="filterRegDateTo" type="date" />
              </div>
            </div>

            <div class="filter-group grow">
              <label for="filterRegSearch">Recherche</label>
              <input id="filterRegSearch" type="text" placeholder="√âtape, projet, description, client..." />
            </div>

            <div class="filter-group">
              <label for="filterRegSortStep">Ordre √©tape</label>
              <select id="filterRegSortStep">
                <option value="none">Par d√©faut</option>
                <option value="asc">√âtape A ‚Üí Z</option>
                <option value="desc">√âtape Z ‚Üí A</option>
              </select>
            </div>
          </div>

          <!-- Tableau registre -->
          <div class="card">
            <div class="table-wrapper">
              <table class="data-table">
                <thead id="regHead"></thead>
                <tbody id="regBody"></tbody>
              </table>
            </div>
          </div>

          <!-- R√©sum√©s registre -->
          <div class="section-block">
            <h3>R√©sum√© par projet</h3>
            <div id="regSummary" class="summary-grid"></div>
          </div>
        </section>

        <!-- === BILAN ======================================================= -->
        <section id="tab-bilan" class="tab-panel">
          <div class="tab-header">
            <div>
              <h2>Bilan</h2>
              <p class="muted">
                Synth√®se des claims factur√©es / pay√©es par projet.
              </p>
            </div>
          </div>

          <!-- Filtres bilan -->
          <div class="filters-row">
            <div class="filter-group">
              <label for="filterBilanType">Type</label>
              <select id="filterBilanType">
                <option value="all">Tous</option>
                <option value="milestone">Milestone</option>
                <option value="dcr">DCR</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="filterBilanProjet">Projet</label>
              <select id="filterBilanProjet">
                <option value="all">Tous</option>
              </select>
            </div>

            <div class="filter-group">
              <label for="filterBilanStatut">Statut</label>
              <select id="filterBilanStatut">
                <option value="all">Tous</option>
                <option value="√Ä facturer">√Ä facturer</option>
                <option value="Factur√©">Factur√©</option>
                <option value="Approuv√©">Approuv√©</option>
                <option value="Pay√©">Pay√©</option>
                <option value="Annul√©">Annul√©</option>
              </select>
            </div>

            <div class="filter-group grow">
              <label for="filterBilanSearch">Recherche</label>
              <input
                id="filterBilanSearch"
                type="text"
                placeholder="√âtape, projet, description, client..."
              />
            </div>

            <div class="filter-group">
              <label for="filterBilanSortStep">Ordre √©tape</label>
              <select id="filterBilanSortStep">
                <option value="none">Par d√©faut</option>
                <option value="asc">√âtape A ‚Üí Z</option>
                <option value="desc">√âtape Z ‚Üí A</option>
              </select>
            </div>
          </div>

          <!-- Tableau bilan -->
          <div class="card">
            <div class="table-wrapper">
              <table class="data-table">
                <thead id="bilanHead"></thead>
                <tbody id="bilanBody"></tbody>
              </table>
            </div>
          </div>

          <!-- R√©sum√©s bilan -->
          <div class="section-block">
            <h3>R√©sum√© par projet</h3>
            <div id="bilanSummary" class="summary-grid"></div>
          </div>
        </section>
        <!-- === FICHIER ===================================================== -->
        <section id="tab-fichier" class="tab-panel">
          <div class="tab-header">
            <div>
              <h2>Fichiers</h2>
              <p class="muted">
                Import et export de donn√©es.
              </p>
            </div>
          </div>

          <div class="card">
            <h3>Export</h3>
            <div class="export-buttons">
              <button id="btnExportJson" class="btn">
                ‚¨á JSON
              </button>
              <button id="btnExportCsv" class="btn">
                ‚¨á CSV
              </button>
              <button id="btnExportExcel" class="btn">
                ‚¨á XLSX
              </button>
              <button id="btnExportPdf" class="btn">
                üñ® PDF / Impression
              </button>
              <button id="btnExportExcelPreview" class="btn">
                üëÅ Pr√©visualiser & XLSX
              </button>
              <button id="btnSaveSnapshot" class="btn primary">
                üíæ Snapshot JSON local
              </button>
            </div>
          </div>

          <div class="card">
            <h3>Import</h3>
            <div class="import-section">
              <input type="file" id="importFile" accept=".json" style="margin-bottom: 8px;" />
              <button id="btnImportJson" class="btn">
                ‚¨Ü Import JSON
              </button>
            </div>
          </div>
        </section>
        <!-- === RAPPORT ===================================================== -->
        <section id="tab-rapport" class="tab-panel">
          <div class="report-header">
            <h2>Rapport global</h2>
            <p class="muted">
              Vision d‚Äôensemble des milestones, DCR et avancement vs contrat.
            </p>
          </div>

          <div id="rapportGlobal"></div>
        </section>

        <!-- === ARCHIVE ===================================================== -->
        <section id="tab-archive" class="tab-panel">
          <div class="tab-header">
            <div>
              <h2>Archive des claims</h2>
              <p class="muted">
                Nommez les claims, g√©rez les factures et pr√©parez les dossiers
                d‚Äôaudit.
              </p>
            </div>
          </div>

          <div class="archive-layout">
            <!-- Liste des claims -->
            <div class="archive-left">
              <div class="filters-row">
                <div class="filter-group grow">
                  <label for="archiveSearch">Recherche</label>
                  <input
                    id="archiveSearch"
                    type="text"
                    placeholder="Nom, √©tape, projet..."
                  />
                </div>
                <div class="filter-group">
                  <label for="archiveSort">Ordre</label>
                  <select id="archiveSort">
                    <option value="recent">Plus r√©centes</option>
                    <option value="name-asc">Nom A ‚Üí Z</option>
                    <option value="name-desc">Nom Z ‚Üí A</option>
                  </select>
                </div>
              </div>

              <div class="archive-counter" id="archiveCount">
                Aucune claim
              </div>

              <div class="card archive-list-card">
                <div id="archiveList" class="archive-list"></div>
              </div>
            </div>

            <!-- D√©tail + aper√ßu -->
            <div class="archive-right">
              <div class="archive-preview-pane">
                <div
                  id="archiveDetailEmpty"
                  class="archive-preview-empty"
                >
                  S√©lectionnez une claim dans la liste de gauche pour voir ses
                  informations et les fichiers associ√©s.
                </div>
                <div
                  id="archiveDetail"
                  class="archive-preview"
                  style="display: none;"
                ></div>
              </div>
            </div>
          </div>
        </section>

<!-- === AUDIT ======================================================= -->
<section id="tab-audit" class="tab-panel">
  <div class="tab-header">
    <div>
      <h2>Audit &amp; contr√¥les</h2>
      <p class="muted">
        S√©lectionnez un ensemble de claims et g√©n√©rez un dossier d‚Äôaudit
        avec toutes les factures associ√©es.
      </p>
    </div>
    <div class="tab-header-actions">
      <button id="btnAuditNew" class="btn">
        Nouveau dossier
      </button>
      <button id="btnAuditCancel" class="btn secondary">
        Annuler l‚Äôaudit
      </button>
      <button id="btnAuditDownloadGlobal" class="btn primary">
        ‚¨á T√©l√©charger le ZIP d‚Äôaudit
      </button>
    </div>
  </div>

  <div class="audit-layout">
    <!-- Partie gauche : table des claims -->
    <div class="audit-left">
      <!-- Filtres audit -->
      <div class="filters-row">
        <div class="filter-group">
          <label for="auditDateFrom">Date de</label>
          <input id="auditDateFrom" type="date" />
        </div>
        <div class="filter-group">
          <label for="auditDateTo">Date √†</label>
          <input id="auditDateTo" type="date" />
        </div>
        <div class="filter-group">
          <label for="auditFilterType">Type</label>
          <select id="auditFilterType">
            <option value="all">Tous</option>
            <option value="milestone">Milestone</option>
            <option value="dcr">DCR</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="auditFilterStatut">Statut</label>
          <select id="auditFilterStatut">
            <option value="all">Tous</option>
            <option value="√Ä facturer">√Ä facturer</option>
            <option value="Factur√©">Factur√©</option>
            <option value="Approuv√©">Approuv√©</option>
            <option value="Pay√©">Pay√©</option>
            <option value="Annul√©">Annul√©</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="auditFilterProjet">Projet</label>
          <select id="auditFilterProjet">
            <option value="all">Tous</option>
          </select>
        </div>
      </div>

      <!-- Recherche + tri -->
      <div class="filters-row">
        <div class="filter-group grow">
          <label for="auditSearch">Recherche</label>
          <input
            id="auditSearch"
            type="text"
            placeholder="Nom, √©tape, projet, facture..."
          />
        </div>
        <div class="filter-group">
          <label for="auditSort">Ordre</label>
          <select id="auditSort">
            <option value="date-desc">Date d√©croissante</option>
            <option value="name-asc">Nom A ‚Üí Z</option>
            <option value="name-desc">Nom Z ‚Üí A</option>
          </select>
        </div>
      </div>

      <!-- Tableau audit -->
      <div class="card">
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Sel.</th>
                <th>√âtape</th>
                <th>Projet</th>
                <th>Type</th>
                <th>Date</th>
                <th>Montant HT</th>
                <th>Taxe</th>
                <th>Montant TTC</th>
                <th>Statut</th>
                <th>Facture</th>
              </tr>
            </thead>
            <!-- ‚ö†Ô∏è C'est ce tbody que ton app.js attend -->
            <tbody id="auditClaimsBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Partie droite : r√©sum√© audit -->
    <aside class="audit-right">
      <div class="card">
        <div class="audit-status" id="auditCurrentStatus">
          Aucun audit en cours.
        </div>

        <div class="audit-section">
          <div class="audit-section-title">Claims s√©lectionn√©es</div>
          <ul id="auditReceiptsList" class="audit-list"></ul>
          <div id="auditTotals" class="audit-totals"></div>
        </div>

        <div class="audit-section">
          <div class="audit-section-title">
            Factures ajout√©es au dossier
          </div>
          <ul id="auditHistoryList" class="audit-list"></ul>
        </div>
      </div>
    </aside>
  </div>
</section>

        <!-- === TRAITEMENT ================================================== -->
        <section id="tab-traitement" class="tab-panel">
          <div class="tab-header">
            <div>
              <h2>Traitement de facturation</h2>
              <p class="muted">
                Classez, compilez et envoyez les documents de facturation aux clients.
              </p>
            </div>
            <div class="tab-header-actions">
              <span id="traitementClaimCounter" class="tab-kpi"></span>
            </div>
          </div>

          <!-- Sous-onglets Traitement -->
          <div class="subtabs-bar">
            <button class="subtab-btn active" data-subtab="paiement-claim">
              Paiement claim
            </button>
            <button class="subtab-btn" data-subtab="compilation">
              Compilation
            </button>
          </div>

          <!-- Contenu des sous-onglets -->
          <div id="subtab-paiement-claim" class="subtab-content active">
            <div class="card">
              <h3>Paiement Claim</h3>
              <p class="muted">Traitement des paiements de claims.</p>
              <div id="paiementClaimContent">
                <!-- Contenu sera g√©n√©r√© par JavaScript -->
              </div>
            </div>
          </div>

          <div id="subtab-compilation" class="subtab-content">
            <div class="card">
              <h3>Compilation</h3>
              <p class="muted">Compilation des documents de facturation.</p>
              <div id="compilationContent">
                <!-- Contenu sera g√©n√©r√© par JavaScript -->
              </div>
            </div>
          </div>
        </section>

        <!-- === PARAM√àTRES ================================================== -->
        <section id="tab-parametres" class="tab-panel">
          <div class="tab-header">
            <div>
              <h2>Param√®tres &amp; r√©f√©rentiels</h2>
              <p class="muted">
                Contrat, taxes, projets et membres autoris√©s.
              </p>
            </div>
          </div>

          <div class="section-grid-2">
            <!-- Contrat & provinces -->
            <div class="card">
              <h3>Contrat / Environnement</h3>
              <div class="form-grid">
                <div class="form-field">
                  <label for="envContratNumero">Num√©ro de contrat</label>
                  <input id="envContratNumero" type="text" />
                </div>
                <div class="form-field">
                  <label for="envContratHt">Contrat HT</label>
                  <input id="envContratHt" type="number" step="0.01" />
                </div>
                <div class="form-field">
                  <label for="envContratTtc">Contrat TTC</label>
                  <input id="envContratTtc" type="number" step="0.01" />
                </div>
                <div class="form-field">
                  <label for="envDefaultProvMs">
                    Province par d√©faut Milestones
                  </label>
                  <select id="envDefaultProvMs"></select>
                </div>
                <div class="form-field">
                  <label for="envDefaultProvDcr">Province par d√©faut DCR</label>
                  <select id="envDefaultProvDcr"></select>
                </div>
                <div class="form-field">
                  <label for="envDefaultProvReserve">
                    Province par d√©faut R√©serve
                  </label>
                  <select id="envDefaultProvReserve"></select>
                </div>
              </div>
            </div>

            <!-- Param√®tres de traitement -->
            <div class="card">
              <h3>Param√®tres de traitement</h3>
              <p class="muted" style="margin-top:0;">Taxes provinciales propos√©es par d√©faut dans Paiement claim.</p>
              <div class="form-grid">
                <div class="form-field">
                  <label for="procTaxDefault1">Taxe par d√©faut #1</label>
                  <select id="procTaxDefault1"></select>
                </div>
                <div class="form-field">
                  <label for="procTaxDefault2">Taxe par d√©faut #2</label>
                  <select id="procTaxDefault2"></select>
                </div>
                <div class="form-field">
                  <label for="procTaxDefault3">Taxe par d√©faut #3</label>
                  <select id="procTaxDefault3"></select>
                </div>
              </div>
            </div>

            <!-- Projets -->
            <div class="card">
              <div class="card-header">
                <h3>Projets</h3>
                <button id="btnImportMilestonesNLT56" class="btn small secondary" style="margin-left:auto;">
                  Importer milestones NLT5/6
                </button>
                <button id="btnAddProject" class="btn small">
                  + Ajouter un projet
                </button>
              </div>
              <div class="table-wrapper">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Code</th>
                      <th>Libell√©</th>
                      <th>Province taxe</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="projBody"></tbody>
                </table>
              </div>
            </div>

            <!-- Amendements -->
            <div class="card">
              <div class="card-header" style="gap:12px; flex-wrap: wrap;">
                <h3 style="margin-right:auto;">Amendements (avenants financiers)</h3>
                <div class="form-field" style="min-width: 240px;">
                  <label for="amendProjectSelect" class="muted" style="font-size:12px;">Projet</label>
                  <select id="amendProjectSelect"></select>
                </div>
                <button id="btnAddAmendment" class="btn small">
                  + Ajouter un amendement
                </button>
              </div>
              <div class="table-wrapper">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Num√©ro</th>
                      <th>D√©signation</th>
                      <th>Montant HT</th>
                      <th>Montant TTC</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="amendBody"></tbody>
                </table>
              </div>
            </div>

            <!-- Taxes -->
            <div class="card">
              <div class="card-header">
                <h3>Taxes</h3>
                <button id="btnAddTax" class="btn small">
                  + Ajouter une taxe
                </button>
              </div>
              <div class="table-wrapper">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Province</th>
                      <th>Taux</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="taxBody"></tbody>
                </table>
              </div>
            </div>

            <!-- Team members -->
            <div class="card">
              <div class="card-header">
                <h3>Membres autoris√©s</h3>
                <button id="btnAddMember" class="btn small">
                  + Ajouter un membre
                </button>
              </div>
              <div class="table-wrapper">
                <table class="data-table team-members-table">
                  <thead>
                    <tr>
                      <th class="col-email">Email</th>
                      <th class="col-name">Nom</th>
                      <th class="col-role">R√¥le</th>
                      <th class="col-active">Actif</th>
                      <th class="col-actions"></th>
                    </tr>
                  </thead>
                  <tbody id="teamBody"></tbody>
                </table>
              </div>
            </div>

            <!-- D√©lais de traitement -->
            <div class="card">
              <h3>D√©lais de traitement des claims</h3>
              <div class="form-grid">
                <div class="form-field">
                  <label for="delayAFacturer">√Ä facturer</label>
                  <div class="delay-input-group">
                    <input id="delayAFacturer" type="number" min="0" step="0.5" value="1" />
                    <select id="delayAFacturerUnit">
                      <option value="day">Jour(s)</option>
                      <option value="week">Semaine(s)</option>
                      <option value="month" selected>Mois</option>
                      <option value="quarter">Trimestre(s)</option>
                      <option value="semester">Semestre(s)</option>
                      <option value="year">Ann√©e(s)</option>
                    </select>
                  </div>
                </div>
                <div class="form-field">
                  <label for="delayFacture">Factur√©</label>
                  <div class="delay-input-group">
                    <input id="delayFacture" type="number" min="0" step="0.5" value="1" />
                    <select id="delayFactureUnit">
                      <option value="day">Jour(s)</option>
                      <option value="week">Semaine(s)</option>
                      <option value="month" selected>Mois</option>
                      <option value="quarter">Trimestre(s)</option>
                      <option value="semester">Semestre(s)</option>
                      <option value="year">Ann√©e(s)</option>
                    </select>
                  </div>
                </div>
                <div class="form-field">
                  <label for="delayPaye">Pay√©</label>
                  <div class="delay-input-group">
                    <input id="delayPaye" type="number" min="0" step="0.5" value="1" />
                    <select id="delayPayeUnit">
                      <option value="day">Jour(s)</option>
                      <option value="week">Semaine(s)</option>
                      <option value="month" selected>Mois</option>
                      <option value="quarter">Trimestre(s)</option>
                      <option value="semester">Semestre(s)</option>
                      <option value="year">Ann√©e(s)</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- Colonnes du registre -->
            <div class="card">
              <h3>Colonnes du registre</h3>
              <div class="form-grid">
                <div class="form-field">
                  <label for="colId">ID</label>
                  <input id="colId" type="text" value="ID" />
                </div>
                <div class="form-field">
                  <label for="colStep">√âtape</label>
                  <input id="colStep" type="text" value="√âtape" />
                </div>
                <div class="form-field">
                  <label for="colType">Type</label>
                  <input id="colType" type="text" value="Type" />
                </div>
                <div class="form-field">
                  <label for="colProject">Projet</label>
                  <input id="colProject" type="text" value="Projet" />
                </div>
                <div class="form-field">
                  <label for="colDate">Date</label>
                  <input id="colDate" type="text" value="Date" />
                </div>
                <div class="form-field">
                  <label for="colDescription">Description</label>
                  <input id="colDescription" type="text" value="Description" />
                </div>
                <div class="form-field">
                  <label for="colProvince">Province</label>
                  <input id="colProvince" type="text" value="Province" />
                </div>
                <div class="form-field">
                  <label for="colTaxRate">Taxe</label>
                  <input id="colTaxRate" type="text" value="Taxe" />
                </div>
                <div class="form-field">
                  <label for="colAmountHT">Montant HT</label>
                  <input id="colAmountHT" type="text" value="Montant HT" />
                </div>
                <div class="form-field">
                  <label for="colAmountTTC">Montant TTC</label>
                  <input id="colAmountTTC" type="text" value="Montant TTC" />
                </div>
                <div class="form-field">
                  <label for="colStatus">Statut</label>
                  <input id="colStatus" type="text" value="Statut" />
                </div>
                <div class="form-field">
                  <label for="colInvoiceNumber">No facture</label>
                  <input id="colInvoiceNumber" type="text" value="No facture" />
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Authentification par mot de passe -->
    <script src="rfacto-auth.js?v=20260205-1"></script>
    <script>
      // V√©rifier l'authentification avant de charger l'app
      if (!rfactoAuth.isAuthenticated()) {
        console.warn('Non authentifi√©, redirection vers login...');
        window.location.href = '/login.html';
      } else {
        console.log('‚úÖ Authentifi√© avec token');
      }
    </script>

    <!-- JS principal -->
    <script src="app.js?v=20260203-1"></script>
  </body>
</html>
